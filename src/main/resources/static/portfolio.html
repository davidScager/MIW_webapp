<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>BitBank - Registreren</title>
    <link href="portfolio.css" rel="stylesheet" type="text/css"/>
    <link href="BaseLayout.css" rel="stylesheet" type="text/css"/>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script>

        // When the user clicks on <span> (x), close the modal

        function closeDialog() {
            var modal = document.getElementById("assetDialog");
            modal.style.display = "none";
         }


         // When the user clicks anywhere outside of the modal, close it
         window.onclick = function(event) {
            var modal = document.getElementById("assetDialog");
            if (event.target == modal) {
                var modal = document.getElementById("assetDialog");
                modal.style.display = "none";
            }
         }
        $( window ).resize(function() {
            setHeights();
        });

        function buyAsset(symbol, name){
            //alert("Buy "+symbol+" name "+name)
            var element = document.getElementById("dialog_header");
            element.innerText = "Buy: "+ symbol;
            var modal = document.getElementById("assetDialog");
            modal.style.display = "block";
        }

        function assetForSale(symbol, name){
            //alert("Buy "+symbol+" name "+name)
            var element = document.getElementById("dialog_header");
            element.innerText = "For sale: "+ symbol;
            var modal = document.getElementById("assetDialog");
            modal.style.display = "block";
        }


        function setHeights(){
            // Viewport
            var new_height = $( window ).height();
            new_height = new_height -400
            $(".scroll_tbody").height(new_height);
        }
        $( document ).ready(function() {
            console.log( "ready!" );
            loadPortfolio();
            loadAssets();
        });
        function loadAssets(){
            setHeights();
            $('#selectable_assets > tbody').empty();
            $.getJSON( "http://localhost:8080/updateassetsbyapi", function( data ) {
                var json_str = JSON.stringify(data);
                var asset_row = '';
                for (i in data) {
                    console.log( "json row" );
                    console.log( JSON.stringify(data[i]) );
                    asset_row += '<tr onclick="buyAsset(\''+data[i].abbreviation+'\',\''+data[i].name+'\');" id="asset_row" class="ui-widget-content asset_row">';
                    asset_row += '   <td>'+data[i].abbreviation+'</td>';
                    asset_row += '   <td  title="'+data[i].description+'">'+data[i].name+'</td>';
                    asset_row += '   <td>'+data[i].valueInUsd+'</td>';
                    asset_row += '   <td>'+data[i].valueYesterday+'</td>';
                    asset_row += '   <td>'+data[i].valueLastWeek+'</td>';
                    asset_row += '   <td>'+data[i].valueLastMonth+'</td>';
                    asset_row += '</tr>';
                }
                console.log(asset_row );
                $('#selectable_assets > tbody').append(asset_row);
            });
        }

        function loadPortfolio(){
            setHeights();
            $('#selectable_portfolio > tbody').empty();
            $.post("http://localhost:8080/listportfolio",
                {
                    token: "tokenshit",
                    extra: "hille"
                },
                function(data, status){
                    var json_str = JSON.stringify(data);
                    console.log( JSON.stringify(data) );
                    var asset_row = '';
                    for (i in data) {
                        console.log( "json row" );
                        console.log( JSON.stringify(data[i]) );
                        asset_row += '<tr onclick="assetForSale(\''+data[i].assetName+'\',\''+data[i].name+'\');" id="asset_row" class="ui-widget-content asset_row">';
                        asset_row += '   <td>'+data[i].assetName+'</td>';
                        asset_row += '   <td>'+data[i].assetDescription+'</td>';
                        asset_row += '   <td>'+data[i].amount+'</td>';
                        asset_row += '   <td>'+data[i].amountUSD*data[i].amount+'</td>';
                        asset_row += '   <td>'+data[i].forSale+'</td>';
                       asset_row += '</tr>';
                    }
                    $('#selectable_portfolio > tbody').append(asset_row);
                }
            );
       }

    </script>
</head>

<body style="background-color: #2B2B2B";>

<header>
    <div class="container">
        <nav>
            <ul class="nav_links ">
                <li><a href="Transaction.html">Handelen</a></li>
                <li><a href="portfolio.html">Portfolio</a></li>
                <li><a href="TransactionHistory.html">Transacties</a></li>
                <li> <a href="HomeScherm.html"><img src="images/logo.png" class="logo" alt="BitBank-logo"></a></li>
                <li><a href="LoginController.html">Logout</a></li>
                <li> <a class="cta" href="#"><button>Contact</button> </a> </li>
            </ul>
        </nav>

    </div>
</header>

<!-- Portfolio page.-->
<main class="asset-box">
    <!-- Portfolio block.-->
    <div class="asset-form">
        <h1>Portfolio</h1>
        <table id="selectable_portfolio" class="scroll_table" >
            <thead class="scroll_thead">
            <tr class="ui-widget-content scroll_tr">
                <th>Coin</th>
                <th>Naam</th>
                <th>Aantal</th>
                <th>Value USD</th>
                <th>For sale</th>
            </tr>
            </thead>
            <tbody class="scroll_tbody">
            <tr class="">
                <td>Coin</td>
                <td>Naam qweqweqwweqweqweqweee</td>
                <td>200</td>
                <td>32398,99</td>
                <td>2</td>
            </tr>

            </tbody>
        </table>

        <button  onclick="loadPortfolio();">Ververs portfolio</button>
    </div>
    <!-- Asset page.-->
    <div class="koers-form">
        <h1>Live Koers</h1>
            <table id="selectable_assets" class="scroll_table" >
                <thead class="scroll_thead">
                    <tr class="ui-widget-content">
                        <th>Coin</th>
                        <th>Naam</th>
                        <th>Prijs</th>
                        <th>Gisteren</th>
                        <th>Last week</th>
                        <th>Last maand</th>
                    </tr>
                </thead>
                <tbody class="scroll_tbody">
                </tbody>
            </table>

         <button  onclick="loadAssets();">Ververs koers</button>
    </div>
</main>
<!-- End Portfolio page.-->

<footer>
    <img class="BLeft" src="images/B left.png" alt="BLeft">
    <img class="BRight" src="images/B right.png" alt="Bright">
</footer>
</body>

<!-- The Modal -->
<div id="assetDialog" class="modal">
    <!-- Modal content -->
    <div class="modal-content asset-buy">
        <div class="modal-header">
            <div id="dialog_header" class="as_h1"></div>
            <div class="close" onclick="closeDialog();">&times;</div>
        </div>
    </div>

</div>


</html>s