<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Portefeuille Rendement</title>
    <link href="BaseLayout.css" type="text/css" rel="stylesheet">
    <link rel="stylesheet" href="TransactionHistory.css" type="text/css">
    <link rel="stylesheet" href="portfolio.css" type="text/css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script>
        $( window ).resize(function() {
            setHeights();
        });

        function setHeights() {
            var new_height = $(window).height();
            new_height = new_height - 400
            $(".scroll_tbody").height(new_height);
        }

        $( document ).ready(function() {
            console.log( "ready!" );
            loadPortfolioReturns();
        });

        function loadPortfolioReturns() {
            setHeights();
            let user = 2;
            let queryString = "http://localhost:8080/portfolioreturns?userId=" + user;
            $('#selectable > tbody').empty();
            $.getJSON(queryString, function( data ) {
                let portfolio_row = '';
                let koersStijging = { 'up': function( x, y) { return Math.round(((y-x)/ x) * 100)}};
                let portfolioValueNu = 0;
                let portfolioValueYesterday = 0;
                let portfolioValueLastWeek = 0;
                let portfolioValueLastMonth = 0;
                for (i in data) {
                    console.log( "json row");
                    console.log(JSON.stringify(data[i]));
                    portfolio_row += '<tr id="asset_row" class="ui-widget-content portfolio_row">';
                    portfolio_row += '<td>'+data[i].asset.name+'</td>';
                    portfolio_row += '<td>'+data[i].asset.abbreviation+'</td>';
                    portfolio_row += ' <td>'+koersStijging['up'](data[i].asset.valueYesterday, data[i].asset.valueInUsd)+'%'+ '</td>';
                    portfolio_row += ' <td>'+koersStijging['up'](data[i].asset.valueLastWeek, data[i].asset.valueInUsd)+'%'+ '</td>';
                    portfolio_row += ' <td>'+koersStijging['up'](data[i].asset.valueLastMonth, data[i].asset.valueInUsd)+'%'+ '</td>';
                    portfolio_row += ' <td>'+koersStijging['up'](data[i].lastTrade, data[i].asset.valueInUsd)+'%'+ '</td>';
                    portfolio_row += '</tr>';

                    portfolioValueNu = portfolioValueNu + ( data[i].asset.valueInUsd * data[i].amount);
                    portfolioValueYesterday = portfolioValueYesterday + (data[i].asset.valueYesterday * data[i].amount);
                    portfolioValueLastWeek = portfolioValueLastWeek + (data[i].asset.valueLastWeek * data[i].amount);
                    portfolioValueLastMonth = portfolioValueLastMonth + (data[i].asset.valueLastMonth * data[i].amount);

                }
                portfolio_row +='<tr>'
                portfolio_row += '<td>'+'totale portefeuille  '+'</td>';
                portfolio_row += '<td>'+'$' + Math.round(portfolioValueNu)+'</td>';
                portfolio_row += '<td>'+'$' + Math.round(portfolioValueYesterday)+'</td>';
                portfolio_row += '<td>'+'$' + Math.round(portfolioValueLastWeek)+'</td>';
                portfolio_row += '<td>'+'$' + Math.round(portfolioValueLastMonth)+'</td>';
                portfolio_row += '<td>'+ '   '+'</td>';
                portfolio_row += '<td>'+ '   '+'</td>';
                portfolio_row += '</tr>';
                portfolio_row +='<tr>'
                portfolio_row += '<td>'+'  (stijging/daling)    '+'</td>';
                portfolio_row += '<td>'+ '       '+'</td>';
                portfolio_row += ' <td>'+koersStijging['up'](portfolioValueYesterday, portfolioValueNu)+'%'+ '</td>';
                portfolio_row += ' <td>'+koersStijging['up'](portfolioValueLastWeek, portfolioValueNu)+'%'+ '</td>';
                portfolio_row += ' <td>'+koersStijging['up'](portfolioValueLastMonth, portfolioValueNu)+'%'+ '</td>';
                portfolio_row += '</tr>';

                console.log(portfolioValueNu);
                console.log(portfolioValueLastWeek);
                console.log(portfolio_row);
                $('#selectable > tbody').append(portfolio_row);
            });
        }

    </script>
</head>

<body style="background-color: #3C3F41";>

<header>
    <div class="container" >
        <nav>
            <ul class="nav_links ">
                <li><a href="Transaction.html">Handelen</a></li>
                <li><a href="portfolio.html">Portfolio</a></li>
                <li><a href="TransactionHistory.html">Transacties</a></li>
                <li> <a href="HomeScherm.html"><img src="images/logo.png" class="logo" alt="BitBank-logo"></a></li>
                <li><a href="LoginController.html">Login</a></li>
                <li><a href="registreren.html">Registreren</a></li>
                <li> <a class="cta" href="contact.html"><button>Contact</button> </a> </li>
            </ul>
        </nav>

    </div>
</header>

<main class="portfolio-returns">

    <div class="assetlist-returns">
        <h1 style="color: white">Portefeuille rendement </h1>
            <table style="width:75%" bgcolor="#FFFFFF" id="selectable" class="scroll_table">
                <thead class="scroll_thead">
                    <tr class="ui-widget-content">
                        <td></td>
                        <th>Naam cryptovaluta /</th>
                        <th>Code crypto /</th>
                        <th>1 dag /</th>
                        <th>1 week /</th>
                        <th>1 maand /</th>
                        <th>sinds laatste transactie</th>
                    </tr>
                </thead>
                <tbody class="scroll_tbody">
                </tbody>
            </table>

    </div>
</main>


<footer>
    <img class="BLeft" src="images/B left.png" alt="BLeft">
    <img class="BRight" src="images/B right.png" alt="Bright">
</footer>
</body>
</html>